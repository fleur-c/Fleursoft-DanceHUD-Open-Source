// This work is licensed under a Creative Commons Attribution 3.0 Unported License (http://creativecommons.org/licenses/by/3.0/)
list H=["ALL","FEMALE","MALE","LEAD","LEFT","CENTER","RIGHT","GROUP1","GROUP2","GROUP3","GROUP4","GROUP5"];list W=[1,2,4,8,16,32,64,128,256,512,1024,2048];list s=["|","|","|","|","|","|","|","|","|","|","|","|"];list n=["|","ALIAS","DANCE","DELAY","DIALOG","END","GIVE","GROUP","IM","LOOP","MENU","MENUSTYLE","MESSAGE","MIX","NAME","NEXTSEQUENCE","OWNER_SAY","RAND","RANDOM","REGION_SAY","REPEAT","SAY","SETNAME","SHOUT","STOP","STYLE","WHISPER","ZZZDEFER"];list u=[0,12,1032,1042,1032,128,1032,76,1032,65,2057,2057,1561,65,8,1288,1032,1074,65,1561,1280,1561,1032,1561,1280,8,1561,5128];integer ac;string Z="";key U="00000000-0000-0000-0000-000000000000";integer ai;integer p=1;integer d;integer z;integer y;integer w=1;list C;list a;string ab="";integer e;list ad;list G;integer S;integer E=1;integer c;integer r;integer ah;integer x;list ak;string t;list T=["0","1","2","3","4","5","6","7","8","9"];
au(string v,list V){llMessageLinked(-4,12123405,v,llDumpList2String(V,"|"));}
at(){s=[];for(ai=0;ai<llGetListLength(W);++ai){s=s+"|";}for(ai=0;ai<10;++ai){ad=ad+"|";}llSetTimerEvent(45.);}
ar(integer ae,string O){if (e&-!(ae==3)){C=C+"3|-1";}if (~llListFindList([5,24,20],(list)ae)){C=C+(string)ae;}else{C=C+((string)ae+"|"+O);}if (14==ae|ab==""&2==ae){ab=O;}if (ae==2){++y;}e=ae==2;}
integer N(string R){integer q;list i;if (!llGetListLength(G)){t=(string)x+"|"+(string)(~-llGetListLength(C))+"|"+(string)y;G=G+t;return 1;}i=llParseString2List(llList2String(G,0),(list)"|",[]);q=llList2Integer(i,0);if (x^7){if (~llListFindList([9,13,18],(list)q)){au("NCMSG020",[ai,R]);return 0;}if (0<S){au("NCMSG022",[ai,R]);return 0;}++S;}else{if (q==7){au("NCMSG021",[ai,R]);return 0;}}t=(string)x+"|"+(string)(~-llGetListLength(C))+"|"+(string)y;G=G+t;return 1;}
integer m(string ao){list L;integer q;integer ag;integer J;integer M=llGetListLength(G);if (!M){au("NCMSG028",[(string)ai,ao]);return 0;}L=llParseString2List(llList2String(G,-1),(list)"|",[]);q=llList2Integer(L,0);if (q^7){if (q^9){t=llList2String(n,q);q=llList2Integer(L,2);ag=llList2Integer(L,1);J=llList2Integer(llParseString2List(llList2String(C,ag),(list)"|",[]),1);if (y+-q<J){au("NCMSG029",[(string)ai,ao,t,J,y+-q]);L=llParseString2List(llList2String(C,ag),(list)"|",[]);L=llListReplaceList(L,(list)(y+-q),1,1);t=llDumpList2String(L,"|");C=llListReplaceList(C,(list)t,ag,ag);}}}else{S=0;}if (1<M){G=(list)llList2String(G,0);}else{G=[];}return 1;}
integer l(string X){integer q;integer ag;if (x==2){t=llList2String(ak,0);if (E&-!(20==llGetInventoryType(t))){if (!~llListFindList(a,(list)t))a=a+t;if (99<llGetListLength(a)){a=llListSort(a,1,1);au("NCMSG032",(list)((string)llGetListLength(a)));au("NCMSG005b",(list)llDumpList2String(a,","));a=[];}au("NCMSG014",[ai,X,t]);return 1;}return 1;}if (x==10){p=llList2Integer(ak,0);llMessageLinked(-4,305410560+p,"108|"+llList2String(ak,1),"");return 1;}if (!~-x){t=llList2String(ak,0);q=llListFindList(H,(list)t);if (q<1){au(llList2String(["NCMSG012","NCMSG25"],-~q),[ai,X]);return 0;}ak=ak+q;q=~-llList2Integer(ak,1);t=llList2String(ak,2);s=llListReplaceList(s,(list)t,q,q);return 1;}if (x==7){string A=llToUpper(llList2String(ak,0));if (!~llListFindList(["SAME","DIFFERENT"],(list)A)){au("NCMSG011",[ai,X]);return 0;}t=llStringTrim(llGetSubString(X,llSubStringIndex(X,llList2String(ak,1)),-1),3);q=llListFindList(H,(list)llToUpper(t));if (!~q){q=llListFindList(s,(list)llToUpper(t));if (!~q){au("NCMSG016",[ai,X,t]);return 0;}}ak=[A,llList2Integer(W,q),t,llList2String(H,q)];S=0;return 1;}if (x==9){q=llList2Integer(ak,0);if (q<2){au("NCMSG023",[(string)ai,X,q]);return 0;}if (10<q){au("NCMSG024",[(string)ai,X,q,10]);return 0;}return 1;}if (x==11){q=llList2Integer(ak,0);t=llToUpper(llList2String(ak,1));ag=llListFindList(ad,(list)t);if ((~ag)&-!(ag==(~-q))){ad=llListReplaceList(ad,(list)"|",ag,ag);}ad=llListReplaceList(ad,(list)t,~-q,~-q);return 1;}if (x==4){q=llGetListLength(llParseString2List(llList2String(ak,0),(list)",",[]));if (q<3){au("NCMSG015",[ai,X]);return 0;}return 1;}if (x==25){t=llToUpper(llList2String(ak,0));q=llListFindList(ad,(list)t);if (~q){p=-~q;}else{q=llListFindList(ad,(list)"|");if (~q){ad=llListReplaceList(ad,(list)t,q,q);p=-~q;au("NCMSG027",[ai,p,t]);}else{au("NCMSG030",[ai,X,p,t]);}}return 1;}return 1;}
integer b(string Y){list P;list am;integer af;integer q;integer ag;float ap;string aa;if (20==llGetInventoryType(Y)){ar(2,Y);return 1;}P=llParseString2List(Y,["[","]"],[]);am=llParseString2List(llStringTrim(llList2String(P,0),3),[" ",",",":"],[]);aa=llStringTrim(llList2String(am,0),3);x=llListFindList(n,(list)llToUpper(aa));if (!~x){au("NCMSG007",[ai,Y]);return 0;}af=llList2Integer(u,x);if (af&4096){au("NCMSG007",[ai,Y]);return 0;}q=llGetListLength(am);ak=[];if (af&1){if (1<q){ag=(integer)llStringTrim(llList2String(am,1),3);if (ag<0&(!((af&512)==512))){au("NCMSG008",[ai,Y]);return 0;}if (!(ag|(~llListFindList(T,(list)llGetSubString(llStringTrim(llList2String(am,1),3),0,0))))){au("NCMSG009",[ai,Y]);return 0;}if (!(af&2048^2048|0<ag&ag<11)){au("NCMSG026",[ai,Y,ag,10]);return 0;}}else{ag=llList2Integer([0,0,0,0,0,0,0,0,0,2,p,p,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0],x);}ak=(list)ag;}if (af&2){ap=(float)llStringTrim(llList2String(am,1),3);if (ap<0.1){au("NCMSG010",[ai,Y]);return 0;}if (ap==0.&(!~llListFindList(T,(list)llGetSubString(llStringTrim(llList2String(am,1),3),0,0)))){au("NCMSG010",[ai,Y]);return 0;}ak=(list)((integer)(ap*10.));if (2<q&(af&32)==32){ap=(float)llStringTrim(llList2String(am,2),3);if (ap<0.1){au("NCMSG010",[ai,Y]);return 0;}if (ap==0.&(!~llListFindList(T,(list)llGetSubString(llStringTrim(llList2String(am,2),3),0,0)))){au("NCMSG010",[ai,Y]);return 0;}ak=ak+(integer)(ap*10.);}}if (af&4){if (x==7){if (1<q){ak=(list)llToUpper(llStringTrim(llList2String(am,1),3));}else{ak=(list)"SAME";}}if (!~-x){if (1<q){ak=(list)llToUpper(llStringTrim(llList2String(am,1),3));}else{au("NCMSG013",[ai,Y]);return 0;}}}if (af&8){t=llStringTrim(llList2String(P,1),3);if (1<llGetListLength(P)){ak=ak+t;}else{t=llList2String(n,x);au("NCMSG017",[ai,Y,t]);return 0;}}if (!l(Y)){return 0;}ar(x,llDumpList2String(ak,"|"));if (af&64){if (!N(Y)){C=llDeleteSubList(C,-1,-1);}}if (af&128){if (!m(Y)){C=llDeleteSubList(C,-1,-1);}}q=0;if (af&256){q=1;}return q;}
as(string K){integer o;string aj;list Q;integer D;integer aq=llStringLength(K);integer g;integer k;Q=llParseStringKeepNulls(K,(list)"|",[]);K="";g=llGetListLength(Q);for(o=0;o<g&(!k);++o){aj=llStringTrim(llList2String(Q,o),3);if (!(aj=="")){if (llGetSubString(aj,0,0)=="["){k=b(aj);}else{if (20^llGetInventoryType(aj)){D=(integer)((float)aj*10.);if (D){if (D<0){au("NCMSG008",[ai,aj]);}else{if (D<5){au("NCMSG034",[ai,aj,aj]);D=5;}ar(3,(string)D);}}else{ar(2,aj);if (E&-!~llListFindList(a,(list)aj)){a=a+aj;if (99<llGetListLength(a)){a=llListSort(a,1,1);au("NCMSG032",(list)((string)llGetListLength(a)));au("NCMSG005b",(list)llDumpList2String(a,","));a=[];}}if (!(o^(~-g)|aq^255)){au("NCMSG006",[(string)ai,aj]);}}}else{ar(2,aj);}}}}if (k&-(o<g)){au("NCMSG019",[ai,aj]);}if (w){if (e){ar(3,"-1");}D=llGetListLength(G);if (0<D){for(o=0;o<D;++o){b("[END]");}}o=llGetListLength(C);if (0<o){if (ab==""){ab="Sequence "+(string)(++z);}if (2==o){Q=llParseString2List(llList2String(C,0),(list)"|",[]);if (llList2Integer(Q,0)==2){Q=llParseString2List(llList2String(C,1),(list)"|",[]);if (!(llList2Integer(Q,0)^3|(~llList2Integer(Q,1)))){C=C+20;}}}llMessageLinked(-4,305410560+p,"101|"+ab,llDumpList2String(C,"|||"));if (ah){llMessageLinked(-4,12123408,"2",(string)(305410560+p));}++d;}else{if (c){llMessageLinked(-4,305410560+p,"110","");}}}}
default{
state_entry(){at();}
changed(integer j){if (j&128)llResetScript();}
link_message(integer h,integer B,string f,key F){if ((!B)&f=="RESET")llResetScript();if (12123401==B){list al;al=llParseString2List(f,(list)"|",[]);if (llToUpper(llList2String(al,0))=="LOAD"){p=-305410560+llList2Integer(al,2);ah=0;if (ac){au("NCMSG001",[Z,llList2String(al,1)]);}else{Z=llList2String(al,1);if (llGetInventoryType(Z)^7){au("NCMSG003",(list)Z);}else{if (llGetSubString(Z,0,2)=="~FS"){au("NCMSG033",(list)Z);return;}ac=1;au("NCMSG002",[Z,p]);d=0;w=1;ai=0;U=llGetNotecardLine(Z,ai);}}return;}if (llToUpper(llList2String(al,0))=="REMEMBER"){if (ac){au("NCMSG001",[Z,llList2String(al,1)]);}else{ab="";C=[];y=0;e=0;d=0;w=1;Z="";p=-305410560+llList2Integer(al,1);ah=1;as(F);}return;}if (llToUpper(llList2String(al,0))=="REDIRECT"){p=-305410560+llList2Integer(al,1);return;}if (llToUpper(llList2String(al,0))=="MISSING"){E=llList2Integer(al,1);return;}if (llToUpper(llList2String(al,0))=="BLANK"){c=llList2Integer(al,1);return;}if (llToUpper(llList2String(al,0))=="COMMENT"){r=llList2Integer(al,1);return;}if (llToUpper(llList2String(al,0))=="ALIASES"){x=(integer)((string)F);t=llDumpList2String(s,",");llMessageLinked(-4,x,"ALIASES",(key)t);t="";return;}}}
dataserver(key an,string I){if (an==U){if (!(I=="\n\n\n")){++ai;if (!(ai%50)){au("NCMSG031",(list)ai);}if (I==""){if (c){llMessageLinked(-4,305410560+p,"110","");}}else{if (llGetSubString(I,0,0)=="#"){if (r&-(1<llStringLength(I))){llMessageLinked(-4,305410560+p,"111",llGetSubString(I,1,-1));}}else{if (w){ab="";C=[];y=0;e=0;}w=1;if (llGetSubString(I,-1,-1)=="\\"){w=0;I=llGetSubString(I,0,-2);}as(I);}}U=llGetNotecardLine(Z,ai);return;}if (llGetListLength(a)){a=llListSort(a,1,1);au("NCMSG005",(list)((string)llGetListLength(a)));au("NCMSG005b",(list)llDumpList2String(a,","));}au("NCMSG004",[Z,(string)d]);llMessageLinked(-4,12123408,"LOADED",Z);t=llDumpList2String(s,",");llMessageLinked(-4,303181825,"ALIASES",(key)t);t="";ac=0;}}
timer(){llMessageLinked(-4,12123430,"","");}
}// lsl script: ~FSRead  optimized at:Thu Sep  5 19:54:15 2019
